# Epic 3 Retrospective — Phase 2 (Corrective Stories Review)

**Date:** 2026-02-11
**Epic:** Epic 3 - Multi-Analysis Management
**Status:** ALL 11 STORIES DONE — Pending 2 fixes before final closure
**Phase 1 Retro:** epic-3-retro-2026-02-10.md (identified 6 major issues)
**Phase 2 Retro:** This document (reviews corrective stories 3-5 to 3-11)
**Participants:** JB (Project Lead), Bob (Scrum Master), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

---

## Executive Summary

Epic 3 Phase 1 retro (2026-02-10) discovered 6 major issues including 2 CRITICAL bugs. The team responded with 7 corrective stories (3-5 to 3-11), all completed. This Phase 2 retro reviews the corrective work, captures new findings, and prepares for Epic 4.

**Key Outcome:** 9/10 action items from Phase 1 retro completed. 2 new issues discovered (What-If focus bug, French badge). JB confirms tool is stable and close to MVP value.

**Context:** JB has internal demo in 2 days (2026-02-13) to present tool to colleagues.

---

## Epic 3 Complete Metrics

| Metric | Value |
|--------|-------|
| **Total Stories** | 11 (4 original + 7 corrective) |
| **Stories Done** | 11/11 (100%) |
| **Test Count** | ~603 → ~860 (+43% growth) |
| **Pre-existing Test Failures** | 54 (French labels in some test files) |
| **Files Modified (corrective phase)** | ~120+ files |
| **New Components Created** | 9 (MiniCard, FocusSidebar, ServiceCostInput, ComparisonView, AnalysisSummary, DeltaIndicator, ComparisonActionBar, ModifiedFieldHighlight, ReplaceConfirmationModal) |

---

## Phase 1 Retro Action Items — Follow-Through

| # | Action Item | Status | Story |
|---|------------|--------|-------|
| 1 | Fix Delete function (CRITICAL) | ✅ DONE | 3-6: stopPropagation fix |
| 2 | What-If Scenario Comparison (CRITICAL) | ✅ DONE | 3-10 + 3-11 (split into core + polish) |
| 3 | UI Labels French → English (URGENT) | ✅ DONE | 3-5: 79 files, 4 parallel agents |
| 4 | Remove Detection Rate from GlobalSidebar (HIGH) | ✅ DONE | 3-7: 195→115 lines |
| 5 | FocusSidebar Navigation (HIGH) | ✅ DONE | 3-9: MiniCard + sidebar + ServiceCostInput extraction |
| 6 | Fix Service Cost Increment (MEDIUM) | ✅ DONE | 3-8: 1-line fix (remove min={1}) |
| 7 | Definition of Done with user validation | ✅ APPLIED | Checklist in every corrective story |
| 8 | Update Dev Prompts: story file updates | ✅ APPLIED | Comprehensive story files |
| 9 | Stories must reference previous retro decisions | ✅ APPLIED | "Previous Retro Context" sections |
| 10 | Update DESIGN_FEEDBACK.md | ✅ DONE | Updated 2026-02-11 with Epic 3 feedback |

**Result: 10/10 action items completed or applied**

---

## Successes — What Went Well

### 1. 100% Critical Fix Completion
All 6 bugs/gaps identified in Phase 1 retro were resolved. Every corrective story delivered on its objectives. This is a major improvement over Epic 2 retro follow-through (partial).

### 2. Parallel Development Efficiency
Story 3-5 (English translation): 79 files modified, 4 parallel agents, ~3h actual vs ~14h estimated = 79% time savings. Demonstrates team can handle large-scale refactoring efficiently.

### 3. Adversarial Code Reviews Caught Real Bugs
- Story 3-9: Performance issue (ConnectedFocusSidebar), accessibility (aria-current), duplication
- Story 3-10: Missing responsive layout (HIGH), unsafe Escape key during editing (MEDIUM), non-functional scroll sync test (MEDIUM)
- Story 3-11: ModifiedFieldHighlight refactoring, name preservation, type cleanup

### 4. Process Improvements Applied Consistently
- Definition of Done checklist in every corrective story
- Previous retro decisions referenced explicitly
- Story files comprehensive (Dev Notes, Code Review, Completion Notes)
- Root cause analysis documented before each fix

### 5. Close to MVP Client Value
JB feedback: "On est plus très loin d'un MVP qui apporte vraiment de la valeur au client." What-If mode, FocusSidebar, English UI = real client meeting value.

---

## Challenges — Issues Found

### 1. BUG: What-If Input Focus Loss (NEW — CRITICAL)
**Affects:** All input fields in the What-If right panel (editable)
**Behavior:** Typing a single character in any field causes immediate focus loss. User cannot complete a value entry (e.g., typing "50" — after "5", focus is lost and value commits as "5").
**Root Cause:** ModifiedFieldHighlight wrapper changes DOM structure when isModified transitions from false to true. React destroys/recreates child elements, losing input focus.
**Fix Strategy:** CSS-only transitions (opacity/visibility) instead of conditional DOM mount/unmount. Apply styles via classes without changing DOM tree structure.
**Impact:** CRITICAL for client meetings — editing must be fluid.

### 2. 54 Pre-existing Test Failures
French labels remaining in test files for FailureRateInput, DowntimeInputs, WaferInputs, EquipmentInputs. Present since Story 3-5 translation, carried through 6 subsequent stories without being fixed.

### 3. Commit Boundary Issue (3-10 / 3-11)
Story 3-10 commit (f54dc81) imported files from Story 3-11 that didn't exist yet. The 3-10 commit is technically broken without 3-11. Stories that are split must maintain independent commit integrity.

### 4. Story File Status Inconsistencies
- Stories 3-6 and 3-7: status "review" in file but "done" in sprint-status.yaml
- Stories 3-9, 3-11: manual testing checkboxes not checked in DoD
- Badge "Analyse active" in Focus Mode still in French (missed by Story 3-5)

---

## New Bug Discovered During Retro

### BUG: "Analyse active" Badge in French
**Location:** Focus Mode header, next to analysis title
**Current:** Green badge "Analyse active" (French)
**Problem:** Missed by Story 3-5 English translation
**Additional:** Badge is redundant in Focus Mode (user already knows which analysis is active)
**Decision (JB):** Remove badge from Focus Mode. Add ROI-colored classification badges to Dashboard cards instead (deferred to design polish).

---

## Design Feedback Captured (→ DESIGN_FEEDBACK.md)

| # | Feedback | Type |
|---|----------|------|
| D1 | What-If split-screen: grid layout, no scroll, everything visible | Layout |
| D2 | What-If: MODIFIED badge on BOTH sides (left + right) for visual link | UX |
| D3 | Service Cost: always at bottom of sidebar (consistent with Focus Mode) | Consistency |
| D4 | Dashboard: ROI-colored classification badges per analysis card | UX |
| D5 | Remove redundant "Analyse active" badge from Focus Mode | Cleanup |

All items captured in DESIGN_FEEDBACK.md — deferred to post-Epic 6 design branch.

---

## Action Items — Epic 3 Final Closure

### BEFORE INTERNAL DEMO (2026-02-13)

| # | Action | Priority | Owner |
|---|--------|----------|-------|
| 1 | Fix What-If input focus loss (ModifiedFieldHighlight CSS refactor) | **CRITICAL** | Dev team |
| 2 | Fix/remove "Analyse active" French badge in Focus Mode | **HIGH** | Dev team |

### AFTER INTERNAL DEMO

| # | Action | Priority | Owner |
|---|--------|----------|-------|
| 3 | Fix 54 failing tests (French labels in test files) | **HIGH** | Dev team |
| 4 | Update story file statuses (3-6, 3-7 → done; 3-9, 3-11 DoD checkboxes) | **MEDIUM** | Bob (SM) |
| 5 | Update epic-3 status: in-progress → done in sprint-status.yaml | **MEDIUM** | Bob (SM) |

### PROCESS (Ongoing from Epic 4)

| # | Action | Priority | Owner |
|---|--------|----------|-------|
| 6 | Commit discipline: no cross-story imports in commits | **PROCESS** | Team |
| 7 | Fix failing tests immediately (don't carry across stories) | **PROCESS** | Team |

---

## Preparation for Epic 4

### Epic 4: Global Analysis & Comparison (3 stories)
- 4-1: Global Analysis View with Aggregated Metrics
- 4-2: Comparison Table Side-by-Side
- 4-3: Navigation Links and Session Stability

### Prerequisites
- ✅ Multiple analyses functional (Epic 2 + 3)
- ✅ Dashboard with AnalysisCard (Story 3.1)
- ✅ FocusSidebar navigation (Story 3.9)
- ✅ English UI (Story 3.5)
- ⚠️ Fix What-If focus bug before Epic 4 (Action #1)
- ⚠️ Fix 54 failing tests (Action #3)

### Dependencies on Epic 3
- Global Analysis will aggregate data from all analyses (uses same store)
- Comparison Table may share patterns with What-If split-screen (Story 3.10)
- Navigation links build on routing patterns established in Epic 3

---

## Team Agreements

- ✅ Fix critical bugs before internal demo (2 days)
- ✅ Fix failing tests immediately — don't carry debt across stories
- ✅ Commit integrity — each commit must build independently
- ✅ Design feedback captured in DESIGN_FEEDBACK.md, deferred to post-Epic 6
- ✅ Continue adversarial code reviews (proven effective)
- ✅ Continue Definition of Done checklist with manual validation

---

## Next Steps

1. **New session:** Create stories for Action Items #1 and #2 (pre-demo fixes)
2. **After demo:** Collect colleague feedback, create stories for Action Items #3-5
3. **Epic 4:** Begin sprint planning when Epic 3 fully closed

---

## Retrospective Status

**Document Status:** COMPLETE
**Facilitator:** Bob (Scrum Master)
**Document Author:** Claude Opus 4.6
**Epic 3 Status:** 11/11 stories done, 2 fixes pending before final closure
**Next Epic:** Epic 4 - Global Analysis & Comparison
